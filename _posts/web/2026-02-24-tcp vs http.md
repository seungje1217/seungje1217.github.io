---
layout: single
title: "📘 tcp vs http "
toc: true
toc_sticky: true
toc_label: "목차"
categories: web
excerpt: "tcp와 http"
tag: [web]
---

들어가기에 앞서 기초적인 단어에 대해 먼저 설명하겠다.
<br/>
우선 프로토콜이란 서로 통신하기 위한 약속(규칙)이다.
<br/>
TCP도 프로토콜, HTTP도 프로토콜, TLS도 프로토콜이다.
이중 우리는 오늘 TCP와 HTTP에 대해 알아보자.

### OSI 7계층

![image](/assets/images/web/osi.png)

뭐가 뭔지 하나도 모를것이다. 다 이해하면 힘드니 간단하게 설명하면, 네트워크 통신은 역할을 나눠 계층 구조로 동작한다.
그 계층이 7개로 나누어져 있는 거다.
<br/>
이중 우리는 2개의 계층만을 다룰거다.
<br/>
데이터가 안전하게 가도록 책임지는 전송 계층 (Transport Layer), 우리가 실제 사용하는 웹 규칙인 응용 계층 (Application Layer)
<br/>
오늘 알아볼 TCP는 이중에서 전송 계층에 속하고 HTTP는 응용 계층에 속한다.
<br/>
<br/>
즉 TCP는 데이터를 안전하게 전달하는 역할을 하고, HTTP는 그 위에서 어떤 데이터를 어떻게 주고받을지를 정의한다.

<br/>

### TCP

그래서 TCP가 뭐냐? 앞서 HTTP에 대해 쓴 블로그를 보면 HTTP/1.1과 HTTP/2 모두 TCP 기반으로 동작한다며 먼저 언급을 했다.
그렇다면 여기서 자연스럽게 질문이 생긴다.
<br/>
HTTP는 TCP 위에서 동작한다는 게 무슨 뜻일까?
<br/>
우리가 웹에서 데이터를 주고받을 때, HTTP는 “어떤 형식으로 요청하고 응답할지”를 정하는 규칙이다.
<br/>
하지만 그 요청과 응답이 인터넷을 통해 실제로 안전하게 전달되려면 누군가는 그 데이터를 책임지고 운반해야 한다.
<br/>
그 역할을 하는 것이 바로 TCP다.
<br/><br/>
즉, HTTP는 대화의 내용과 형식을 정하고, TCP는 그 대화를 안전하게 전달한다.
<br/>
정확하게 설명하면 HTTP는 TCP 위에서 동작하는 프로토콜이다.
<br/>
<br/>

> 연결 지향적

TCP는 데이터를 보내기 전에 먼저 연결부터 만든다.
이걸 3-Way Handshake라고 한다.

HTTP는 “비연결성”이라고 했지만, 그건 요청/응답이 끝나면 연결을 끊는 구조라는 뜻이고,
TCP는 그 이전 단계에서 “아예 통신을 시작하기 전에 서로 준비가 되었는지 확인하는 과정”이 있다. 
<br/>
TCP는 총 3번의 신호를 주고받는다.
<br/><br/>
1️⃣ SYN (Synchronize)

클라이언트 → 서버
<br/>
“나 너랑 통신하고 싶은데 가능해?”

이때 클라이언트는 자신의 초기 시퀀스 번호(ISN)를 같이 보낸다. 

(시퀀스 번호는 데이터 순서를 맞추기 위한 번호)
<br/><br/>
2️⃣ SYN + ACK

서버 → 클라이언트

“ㅇㅋ 나도 준비됐어. 그리고 네 번호 잘 받았어”
<br/>
서버도 자신의 시퀀스 번호를 보낸다. ACK는 “네 신호를 정상적으로 받았다”는 확인 응답이다.
<br/><br/>
3️⃣ ACK

클라이언트 → 서버

“확인. 이제 통신 시작”

마지막으로 이 신호가 가면 TCP 연결이 완전히 성립된다.
<br/><br/>
너무 복잡해 보이지만 다 이유가 있다. 우선 상대 서버가 실제로 존재하는지 확인. 즉 서버가 실제로 존재하는지 확인을 해야한다. 또한 TCP는 데이터가 순서대로 와야 하기때문에 "나 이 번호부터 시작한다?" 이런식으로 약속을 하는거다. 또한 이렇게 까다로운 과정을 거쳐야지 유실 여부 확인하고 재전송하던가 순서 보장같은 게 가능해진다는거다.
<br/>
<br/>
그럼 왜 HTTP는 비연결성이라고 하면서 TCP 위에서 동작할까? 
<br/><br/>
둘이 역할이 다르니까. 
<br/>TCP는 연결을 관리하는 프로토콜, HTTP는 요청/응답을 정의하는 프로토콜
<br/>
HTTP는 TCP 위에서 동작하지만 요청 단위로 독립적이기에 비연결성이라고 한다.

<br/>

> 신뢰성

TCP는 단순히 연결만 만드는 것이 아니라, 데이터가 정확하게 도착했는지도 확인한다. 아까 TCP가 동작과정에서 클라이언트는 자신의 시퀀스 번호(ISN)를 같이 보낸다고 하였다. 이건 있어보이려고 그러는게 아니다. 
<br/>
중간에 빠진 게 있으면 다시 보내달라고 요청하거나 순서가 뒤바뀌면 재정렬하는 등 잘 도착했는지 확인을 하기 위해 보내는 거다.
<br/>
<br/>
그럼 HTTP는? 
<br/>
HTTP는 이런 거 신경 쓰지 않는다. 그냥 단순히 “GET /users/1 보내고
응답으로 JSON 받는다" 이거만 생각한다. 아까 HTTP는 응용 계층이라 했잖아? 데이터가 중간에 깨졌는지, 순서가 바뀌었는지, 유실됐는지
이건 HTTP의 책임이 아니다. 그건 TCP의 영역이다.

<br/>

> 흐름 제어 / 혼잡 제어

TCP는 무작정 빠르게 데이터를 보내지 않는다. 상대가 처리할 수 있는 만큼만 보내고,
네트워크가 혼잡하면 속도를 줄인다.
<br/><br/>
수신자가 받을 수 있는 크기를 확인(윈도우 사이즈)하고, 네트워크가 혼잡하면 전송 속도를 낮추다 문제가 없으면 점점 속도를 올린다.
<br/><br/>
즉 TCP는 정확하게 보내면서, 네트워크 상황까지 고려하는 프로토콜이다.
<br/>

---

<br/>
TCP는 도로를 만든다.
차선도 정리하고, 신호도 맞추고, 사고가 나면 복구한다.
<br/><br/>
HTTP는 그 도로 위를 달리는 자동차다. 어디로 갈지, 어떤 목적지로 갈지 정한다.
<br/><br/>
도로가 없으면 차는 갈 수 없고, 차가 없으면 도로는 의미가 없을거다.